import { fallback as mooFallback } from 'moo';
export const fallbackRule = { t: 'fallback', ...mooFallback };
function compareLexerRules(x, y) {
    if (x.t === 'string' && y.t === 'string') {
        const xMatch = x.match;
        const yMatch = y.match;
        if (yMatch.startsWith(xMatch)) {
            return 1;
        }
        else if (xMatch.startsWith(yMatch)) {
            return -1;
        }
        else if (yMatch < xMatch) {
            return -1;
        }
        else if (xMatch < yMatch) {
            return 1;
        }
    }
    return 0;
}
export function sortStateRules(state) {
    const entries = Object.entries(state);
    if (entries.length < 2) {
        return state;
    }
    const stringEntries = entries
        .filter(([, { t }]) => t === 'string')
        .sort(([, x], [, y]) => compareLexerRules(x, y));
    const regexEntries = entries.filter(([, { t }]) => t === 'regex');
    const fallbackEntries = entries.filter(([, { t }]) => t === 'fallback');
    return Object.fromEntries([
        ...stringEntries,
        ...regexEntries,
        ...fallbackEntries,
    ]);
}
export function sortStatesMap(statesMap) {
    const result = { ...statesMap };
    Object.entries(result).forEach(([key, val]) => {
        result[key] = sortStateRules(val);
    });
    return result;
}
export function copyStateDefinition(state) {
    const result = { ...state };
    Object.entries(result).forEach(([key, val]) => {
        result[key] = { ...val };
    });
    return result;
}
//# sourceMappingURL=rules.js.map