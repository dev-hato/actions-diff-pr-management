{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../lib/workers/repository/init/index.ts"],"names":[],"mappings":";;;AAAA,mDAAsD;AACtD,qDAA+D;AAE/D,4CAAyC;AACzC,wDAAqD;AACrD,+CAA4C;AAC5C,2CAAsD;AACtD,yDAAkD;AAClD,8CAAkD;AAClD,oDAAgD;AAChD,iCAAkC;AAClC,mCAAwD;AACxD,qCAAyC;AACzC,mDAA4D;AAE5D,SAAS,gBAAgB,CAAC,MAAsB;IAC9C,OAAO,EAAE,GAAG,IAAA,aAAK,EAAC,MAAM,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE,UAAU,EAAE,EAAE,EAAE,CAAC;AACxE,CAAC;AAED,SAAS,wBAAwB,CAAC,MAAsB;IACtD,IAAI,MAAM,CAAC,sBAAsB,IAAI,CAAC,mBAAQ,CAAC,sBAAsB,EAAE;QACrE,sBAAsB;QACtB,MAAM,QAAQ,GAAG,qBAAY,CAAC,GAAG,CAAC,UAAU,CAAE,CAAC;QAC/C,eAAM,CAAC,IAAI,CACT,2FAA2F,QAAQ,IAAI,CACxG,CAAC;KACH;AACH,CAAC;AAEM,KAAK,UAAU,QAAQ,CAC5B,OAAuB;IAEvB,4BAAY,CAAC,KAAK,EAAE,CAAC;IACrB,IAAI,MAAM,GAAmB,gBAAgB,CAAC,OAAO,CAAC,CAAC;IACvD,MAAM,IAAA,mBAAW,GAAE,CAAC;IACpB,MAAM,GAAG,MAAM,IAAA,eAAQ,EAAC,MAAM,CAAC,CAAC;IAChC,MAAM,IAAA,wBAAgB,EAAC,MAAM,CAAC,CAAC;IAC/B,MAAM,GAAG,MAAM,IAAA,sBAAa,EAAC,MAAM,CAAC,CAAC;IACrC,IAAA,8BAAiB,EAAC,MAAM,CAAC,CAAC;IAC1B,wBAAwB,CAAC,MAAM,CAAC,CAAC;IACjC,MAAM,GAAG,IAAA,8BAAoB,EAAC,MAAM,CAAC,CAAC;IACtC,IAAA,uBAAiB,EAAC,MAAM,CAAC,CAAC;IAC1B,MAAM,GAAG,MAAM,IAAA,yCAAyB,EAAC,MAAM,CAAC,CAAC;IACjD,qBAAqB;IACrB,IAAI,MAAM,CAAC,WAAW,EAAE;QACtB,eAAM,CAAC,IAAI,CACT,EAAE,MAAM,EAAE,SAAS,EAAE,IAAA,mBAAM,GAAE,EAAE,EAC/B,sDAAsD,CACvD,CAAC;KACH;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AAtBD,4BAsBC","sourcesContent":["import { GlobalConfig } from '../../../config/global';\nimport { applySecretsToConfig } from '../../../config/secrets';\nimport type { RenovateConfig } from '../../../config/types';\nimport { logger } from '../../../logger';\nimport { platform } from '../../../modules/platform';\nimport { clone } from '../../../util/clone';\nimport { setUserRepoConfig } from '../../../util/git';\nimport { getAll } from '../../../util/host-rules';\nimport { checkIfConfigured } from '../configured';\nimport { PackageFiles } from '../package-files';\nimport { initApis } from './apis';\nimport { initializeCaches, resetCaches } from './cache';\nimport { getRepoConfig } from './config';\nimport { detectVulnerabilityAlerts } from './vulnerability';\n\nfunction initializeConfig(config: RenovateConfig): RenovateConfig {\n  return { ...clone(config), errors: [], warnings: [], branchList: [] };\n}\n\nfunction warnOnUnsupportedOptions(config: RenovateConfig): void {\n  if (config.filterUnavailableUsers && !platform.filterUnavailableUsers) {\n    // TODO: types (#7154)\n    const platform = GlobalConfig.get('platform')!;\n    logger.warn(\n      `Configuration option 'filterUnavailableUsers' is not supported on the current platform '${platform}'.`\n    );\n  }\n}\n\nexport async function initRepo(\n  config_: RenovateConfig\n): Promise<RenovateConfig> {\n  PackageFiles.clear();\n  let config: RenovateConfig = initializeConfig(config_);\n  await resetCaches();\n  config = await initApis(config);\n  await initializeCaches(config);\n  config = await getRepoConfig(config);\n  checkIfConfigured(config);\n  warnOnUnsupportedOptions(config);\n  config = applySecretsToConfig(config);\n  setUserRepoConfig(config);\n  config = await detectVulnerabilityAlerts(config);\n  // istanbul ignore if\n  if (config.printConfig) {\n    logger.info(\n      { config, hostRules: getAll() },\n      'Full resolved config and hostRules including presets'\n    );\n  }\n  return config;\n}\n"]}