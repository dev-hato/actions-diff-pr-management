{"version":3,"file":"config-description.js","sourceRoot":"","sources":["../../../../../../lib/workers/repository/update/pr/body/config-description.ts"],"names":[],"mappings":";;;AAAA,gDAAoD;AACpD,qDAAoD;AAEpD,8DAAiE;AAE1D,KAAK,UAAU,sBAAsB,CAC1C,MAAoB;IAEpB,IAAI,MAAM,GAAG,kCAAkC,CAAC;IAChD,MAAM,IAAI,IAAA,eAAO,EAAC,uBAAuB,CAAC,CAAC;IAC3C,MAAM;QACJ,oBAAoB,GAAG,gBAAgB,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;IAC5E,MAAM;QACJ,gBAAgB;YAChB,gBAAgB,CAAC,MAAM,CAAC,iBAAiB,EAAE,MAAM,CAAC,QAAQ,CAAC;YAC3D,GAAG,CAAC;IAEN,MAAM,IAAI,MAAM,CAAC;IACjB,MAAM,IAAI,IAAA,eAAO,EAAC,0CAA0C,CAAC,CAAC;IAC9D,IAAI,MAAM,CAAC,SAAS,EAAE;QACpB,MAAM,YAAY,GAAG,MAAM,IAAA,mCAAmB,EAC5C,MAAM,CAAC,UAAU,EACjB,MAAM,CAAC,WAAW,CACnB,CAAC;QACF,IAAI,YAAY,KAAK,oBAAY,CAAC,GAAG,EAAE;YACrC,MAAM,IAAI,wCAAwC,CAAC;SACpD;aAAM;YACL,MAAM,IAAI,UAAU,CAAC;SACtB;KACF;SAAM;QACL,MAAM;YACJ,wEAAwE,CAAC;KAC5E;IACD,MAAM,IAAI,MAAM,CAAC;IACjB,MAAM,IAAI,IAAA,eAAO,EAAC,0BAA0B,CAAC,CAAC;IAC9C,IAAI,MAAM,CAAC,UAAU,KAAK,oBAAoB,EAAE;QAC9C,MAAM,IAAI,mCAAmC,CAAC;KAC/C;SAAM,IAAI,MAAM,CAAC,UAAU,KAAK,OAAO,IAAI,MAAM,CAAC,YAAY,EAAE;QAC/D,MAAM,IAAI,OAAO,CAAC;KACnB;SAAM;QACL,MAAM,IAAI,gCAAgC,CAAC;KAC5C;IACD,MAAM,IAAI,8CAA8C,CAAC;IACzD,IAAI,MAAM,CAAC,cAAc,EAAE;QACzB,MAAM,IAAI,IAAA,eAAO;QACf,sBAAsB;QACtB,4EAA4E;QAC5E,yFAAyF,MAAM,CAAC,YAAY,EAAE,IAAI,4BAA4B,CAC/I,CAAC;KACH;SAAM;QACL,MAAM,IAAI,IAAA,eAAO,EACf,uEACE,MAAM,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,eACjD,aAAa,CACd,CAAC;KACH;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AApDD,wDAoDC;AAED,SAAS,gBAAgB,CACvB,QAA8B,EAC9B,QAA4B;IAE5B,IAAI,cAAc,GAAG,EAAE,CAAC;IACxB,IAAI,QAAQ,IAAI,QAAQ,CAAC,CAAC,CAAC,KAAK,aAAa,EAAE;QAC7C,cAAc,IAAI,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC;QAC1C,IAAI,QAAQ,EAAE;YACZ,cAAc,IAAI,gBAAgB,QAAQ,EAAE,CAAC;SAC9C;aAAM;YACL,cAAc,IAAI,QAAQ,CAAC;SAC5B;KACF;SAAM;QACL,cAAc,IAAI,mCAAmC,CAAC;KACvD;IACD,OAAO,cAAc,CAAC;AACxB,CAAC","sourcesContent":["import { BranchStatus } from '../../../../../types';\nimport { emojify } from '../../../../../util/emoji';\nimport type { BranchConfig } from '../../../../types';\nimport { resolveBranchStatus } from '../../branch/status-checks';\n\nexport async function getPrConfigDescription(\n  config: BranchConfig\n): Promise<string> {\n  let prBody = `\\n\\n---\\n\\n### Configuration\\n\\n`;\n  prBody += emojify(`:date: **Schedule**: `);\n  prBody +=\n    'Branch creation - ' + scheduleToString(config.schedule, config.timezone);\n  prBody +=\n    ', Automerge - ' +\n    scheduleToString(config.automergeSchedule, config.timezone) +\n    '.';\n\n  prBody += '\\n\\n';\n  prBody += emojify(':vertical_traffic_light: **Automerge**: ');\n  if (config.automerge) {\n    const branchStatus = await resolveBranchStatus(\n      config.branchName,\n      config.ignoreTests\n    );\n    if (branchStatus === BranchStatus.red) {\n      prBody += 'Disabled due to failing status checks.';\n    } else {\n      prBody += 'Enabled.';\n    }\n  } else {\n    prBody +=\n      'Disabled by config. Please merge this manually once you are satisfied.';\n  }\n  prBody += '\\n\\n';\n  prBody += emojify(':recycle: **Rebasing**: ');\n  if (config.rebaseWhen === 'behind-base-branch') {\n    prBody += 'Whenever PR is behind base branch';\n  } else if (config.rebaseWhen === 'never' || config.stopUpdating) {\n    prBody += 'Never';\n  } else {\n    prBody += 'Whenever PR becomes conflicted';\n  }\n  prBody += `, or you tick the rebase/retry checkbox.\\n\\n`;\n  if (config.recreateClosed) {\n    prBody += emojify(\n      // TODO: types (#7154)\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      `:ghost: **Immortal**: This PR will be recreated if closed unmerged. Get [config help](${config.productLinks?.help}) if that's undesired.\\n\\n`\n    );\n  } else {\n    prBody += emojify(\n      `:no_bell: **Ignore**: Close this PR and you won't be reminded about ${\n        config.upgrades.length === 1 ? 'this update' : 'these updates'\n      } again.\\n\\n`\n    );\n  }\n  return prBody;\n}\n\nfunction scheduleToString(\n  schedule: string[] | undefined,\n  timezone: string | undefined\n): string {\n  let scheduleString = '';\n  if (schedule && schedule[0] !== 'at any time') {\n    scheduleString += `\"${String(schedule)}\"`;\n    if (timezone) {\n      scheduleString += ` in timezone ${timezone}`;\n    } else {\n      scheduleString += ` (UTC)`;\n    }\n  } else {\n    scheduleString += 'At any time (no schedule defined)';\n  }\n  return scheduleString;\n}\n"]}