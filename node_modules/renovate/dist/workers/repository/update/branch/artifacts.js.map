{"version":3,"file":"artifacts.js","sourceRoot":"","sources":["../../../../../lib/workers/repository/update/branch/artifacts.ts"],"names":[],"mappings":";;;AAAA,sDAAyD;AACzD,+CAA4C;AAC5C,2DAAwD;AACxD,6CAAiD;AAG1C,KAAK,UAAU,sBAAsB,CAC1C,MAAoB;IAEpB,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,MAAM,EAAE;QAClC,YAAY;QACZ,OAAO;KACR;IAED,MAAM,OAAO,GAAG,oBAAoB,CAAC;IACrC,MAAM,WAAW,GAAG,8BAA8B,CAAC;IACnD,MAAM,KAAK,GAAG,oBAAY,CAAC,GAAG,CAAC;IAC/B,MAAM,aAAa,GAAG,MAAM,mBAAQ,CAAC,oBAAoB,CACvD,MAAM,CAAC,UAAU,EACjB,OAAO,CACR,CAAC;IAEF,+BAA+B;IAC/B,IAAI,aAAa,KAAK,KAAK,EAAE;QAC3B,eAAM,CAAC,KAAK,CAAC,uCAAuC,CAAC,CAAC;QACtD,IAAI,qBAAY,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAC9B,eAAM,CAAC,IAAI,CAAC,sCAAsC,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;SACzE;aAAM;YACL,MAAM,mBAAQ,CAAC,eAAe,CAAC;gBAC7B,UAAU,EAAE,MAAM,CAAC,UAAU;gBAC7B,OAAO;gBACP,WAAW;gBACX,KAAK;aACN,CAAC,CAAC;SACJ;KACF;AACH,CAAC;AA9BD,wDA8BC","sourcesContent":["import { GlobalConfig } from '../../../../config/global';\nimport { logger } from '../../../../logger';\nimport { platform } from '../../../../modules/platform';\nimport { BranchStatus } from '../../../../types';\nimport type { BranchConfig } from '../../../types';\n\nexport async function setArtifactErrorStatus(\n  config: BranchConfig\n): Promise<void> {\n  if (!config.artifactErrors?.length) {\n    // no errors\n    return;\n  }\n\n  const context = `renovate/artifacts`;\n  const description = 'Artifact file update failure';\n  const state = BranchStatus.red;\n  const existingState = await platform.getBranchStatusCheck(\n    config.branchName,\n    context\n  );\n\n  // Check if state needs setting\n  if (existingState !== state) {\n    logger.debug(`Updating status check state to failed`);\n    if (GlobalConfig.get('dryRun')) {\n      logger.info('DRY-RUN: Would set branch status in ' + config.branchName);\n    } else {\n      await platform.setBranchStatus({\n        branchName: config.branchName,\n        context,\n        description,\n        state,\n      });\n    }\n  }\n}\n"]}