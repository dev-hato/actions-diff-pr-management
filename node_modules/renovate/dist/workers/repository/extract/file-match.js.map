{"version":3,"file":"file-match.js","sourceRoot":"","sources":["../../../../lib/workers/repository/extract/file-match.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAElC,4CAAyC;AACzC,+CAA4C;AAE5C,SAAgB,gBAAgB,CAC9B,QAAkB,EAClB,YAAsB;IAEtB,IAAI,CAAC,YAAY,EAAE,MAAM,EAAE;QACzB,OAAO,CAAC,GAAG,QAAQ,CAAC,CAAC;KACtB;IACD,OAAO,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAC9B,YAAY,CAAC,IAAI,CACf,CAAC,WAAW,EAAE,EAAE,CACd,IAAI,KAAK,WAAW,IAAI,IAAA,mBAAS,EAAC,IAAI,EAAE,WAAW,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CACtE,CACF,CAAC;AACJ,CAAC;AAbD,4CAaC;AAED,SAAgB,kBAAkB,CAChC,QAAkB,EAClB,WAAqB;IAErB,IAAI,CAAC,WAAW,EAAE,MAAM,EAAE;QACxB,OAAO,CAAC,GAAG,QAAQ,CAAC,CAAC;KACtB;IACD,OAAO,QAAQ,CAAC,MAAM,CACpB,CAAC,IAAI,EAAE,EAAE,CACP,CAAC,WAAW,CAAC,IAAI,CACf,CAAC,UAAU,EAAE,EAAE,CACb,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;QACzB,IAAA,mBAAS,EAAC,IAAI,EAAE,UAAU,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAC7C,CACJ,CAAC;AACJ,CAAC;AAfD,gDAeC;AAED,SAAgB,mBAAmB,CACjC,MAAsB,EACtB,QAAkB;IAElB,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,GAAG,MAAM,CAAC;IAC7C,aAAa;IAEb,IAAI,YAAY,GAAG,gBAAgB,CAAC,QAAQ,EAAE,YAAa,CAAC,CAAC;IAC7D,YAAY,GAAG,kBAAkB,CAAC,YAAY,EAAE,WAAY,CAAC,CAAC;IAC9D,OAAO,YAAY,CAAC;AACtB,CAAC;AAVD,kDAUC;AAED,SAAgB,gBAAgB,CAC9B,MAAsB,EACtB,QAAkB;IAElB,MAAM,QAAQ,GAAG,mBAAmB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACvD,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,MAAM,CAAC;IACtC,IAAI,YAAY,GAAa,EAAE,CAAC;IAChC,sBAAsB;IACtB,KAAK,MAAM,KAAK,IAAI,SAAU,EAAE;QAC9B,eAAM,CAAC,KAAK,CAAC,qBAAqB,KAAK,gBAAgB,OAAQ,EAAE,CAAC,CAAC;QACnE,MAAM,EAAE,GAAG,IAAA,aAAK,EAAC,KAAK,CAAC,CAAC;QACxB,YAAY,GAAG,YAAY,CAAC,MAAM,CAChC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CACzC,CAAC;KACH;IACD,wBAAwB;IACxB,OAAO,CAAC,GAAG,IAAI,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAC3C,CAAC;AAjBD,4CAiBC","sourcesContent":["import minimatch from 'minimatch';\nimport type { RenovateConfig } from '../../../config/types';\nimport { logger } from '../../../logger';\nimport { regEx } from '../../../util/regex';\n\nexport function getIncludedFiles(\n  fileList: string[],\n  includePaths: string[]\n): string[] {\n  if (!includePaths?.length) {\n    return [...fileList];\n  }\n  return fileList.filter((file) =>\n    includePaths.some(\n      (includePath) =>\n        file === includePath || minimatch(file, includePath, { dot: true })\n    )\n  );\n}\n\nexport function filterIgnoredFiles(\n  fileList: string[],\n  ignorePaths: string[]\n): string[] {\n  if (!ignorePaths?.length) {\n    return [...fileList];\n  }\n  return fileList.filter(\n    (file) =>\n      !ignorePaths.some(\n        (ignorePath) =>\n          file.includes(ignorePath) ||\n          minimatch(file, ignorePath, { dot: true })\n      )\n  );\n}\n\nexport function getFilteredFileList(\n  config: RenovateConfig,\n  fileList: string[]\n): string[] {\n  const { includePaths, ignorePaths } = config;\n  // TODO #7154\n\n  let filteredList = getIncludedFiles(fileList, includePaths!);\n  filteredList = filterIgnoredFiles(filteredList, ignorePaths!);\n  return filteredList;\n}\n\nexport function getMatchingFiles(\n  config: RenovateConfig,\n  allFiles: string[]\n): string[] {\n  const fileList = getFilteredFileList(config, allFiles);\n  const { fileMatch, manager } = config;\n  let matchedFiles: string[] = [];\n  // TODO: types (#7154)\n  for (const match of fileMatch!) {\n    logger.debug(`Using file match: ${match} for manager ${manager!}`);\n    const re = regEx(match);\n    matchedFiles = matchedFiles.concat(\n      fileList.filter((file) => re.test(file))\n    );\n  }\n  // filter out duplicates\n  return [...new Set(matchedFiles)].sort();\n}\n"]}