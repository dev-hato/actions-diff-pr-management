{"version":3,"file":"errors-warnings.js","sourceRoot":"","sources":["../../../lib/workers/repository/errors-warnings.ts"],"names":[],"mappings":"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","sourcesContent":["// TODO #7154\nimport type { RenovateConfig } from '../../config/types';\nimport { logger } from '../../logger';\nimport type { PackageFile } from '../../modules/manager/types';\nimport { emojify } from '../../util/emoji';\nimport type { DepWarnings } from '../types';\n\nexport function getWarnings(config: RenovateConfig): string {\n  if (!config.warnings?.length) {\n    return '';\n  }\n  let warningText = `\\n# Warnings (${config.warnings.length})\\n\\n`;\n  warningText += `Please correct - or verify that you can safely ignore - these warnings before you merge this PR.\\n\\n`;\n  for (const w of config.warnings) {\n    warningText += `-   \\`${w.topic}\\`: ${w.message}\\n`;\n  }\n  warningText += '\\n---\\n';\n  return warningText;\n}\n\nexport function getErrors(config: RenovateConfig): string {\n  if (!config.errors?.length) {\n    return '';\n  }\n  let errorText = `\\n# Errors (${config.errors.length})\\n\\n`;\n  errorText += `Renovate has found errors that you should fix (in this branch) before finishing this PR.\\n\\n`;\n  for (const e of config.errors) {\n    errorText += `-   \\`${e.topic}\\`: ${e.message}\\n`;\n  }\n  errorText += '\\n---\\n';\n  return errorText;\n}\n\nfunction getDepWarnings(\n  packageFiles: Record<string, PackageFile[]>\n): DepWarnings {\n  const warnings: string[] = [];\n  const warningFiles: string[] = [];\n  for (const files of Object.values(packageFiles ?? {})) {\n    for (const file of files ?? []) {\n      // TODO: remove condition when type is fixed (#7154)\n      if (file.packageFile) {\n        for (const dep of file.deps ?? []) {\n          for (const w of dep.warnings ?? []) {\n            const message = w.message;\n            if (!warnings.includes(message)) {\n              warnings.push(message);\n            }\n            if (!warningFiles.includes(file.packageFile)) {\n              warningFiles.push(file.packageFile);\n            }\n          }\n        }\n      }\n    }\n  }\n  return { warnings, warningFiles };\n}\n\nexport function getDepWarningsPR(\n  packageFiles: Record<string, PackageFile[]>\n): string {\n  const { warnings, warningFiles } = getDepWarnings(packageFiles);\n  let warningText = '';\n  if (!warnings.length) {\n    return '';\n  }\n  logger.debug({ warnings, warningFiles }, 'Found package lookup warnings');\n  warningText = emojify(\n    `\\n---\\n\\n### :warning: Dependency Lookup Warnings :warning:\\n\\n`\n  );\n  warningText += `Please correct - or verify that you can safely ignore - these lookup failures before you merge this PR.\\n\\n`;\n  for (const w of warnings) {\n    warningText += `-   \\`${w}\\`\\n`;\n  }\n  warningText +=\n    '\\nFiles affected: ' +\n    warningFiles.map((f) => '`' + f + '`').join(', ') +\n    '\\n\\n';\n  return warningText;\n}\n\nexport function getDepWarningsDashboard(\n  packageFiles: Record<string, PackageFile[]>\n): string {\n  const { warnings, warningFiles } = getDepWarnings(packageFiles);\n  if (!warnings.length) {\n    return '';\n  }\n\n  const depWarnings = warnings\n    .map((w) => w.replace('Failed to look up dependency ', ''))\n    .map((dep) => '`' + dep + '`')\n    .join(', ');\n\n  logger.debug({ warnings, warningFiles }, 'Found package lookup warnings');\n  let warningText = emojify(\n    `\\n---\\n\\n### :warning: Dependency Lookup Warnings :warning:\\n\\n`\n  );\n  warningText += `-   Renovate failed to look up the following dependencies: `;\n  warningText += depWarnings;\n  warningText += '.\\n\\nFiles affected: ';\n  warningText += warningFiles.map((f) => '`' + f + '`').join(', ');\n  warningText += '\\n\\n---\\n\\n';\n  return warningText;\n}\n"]}