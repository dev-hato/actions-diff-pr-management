{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../lib/modules/manager/cake/index.ts"],"names":[],"mappings":";;;;AAAA,sDAAsB;AACtB,kDAAyD;AACzD,+CAA4C;AAC5C,kDAAyD;AAG5C,QAAA,QAAQ,GAAG,+BAAmB,CAAC,GAAG,CAAC;AAEnC,QAAA,aAAa,GAAG;IAC3B,SAAS,EAAE,CAAC,UAAU,CAAC;CACxB,CAAC;AAEF,MAAM,KAAK,GAAG,aAAG,CAAC,MAAM,CAAC;IACvB,IAAI,EAAE;QACJ,WAAW,EAAE,EAAE,KAAK,EAAE,UAAU,EAAE;QAClC,gBAAgB,EAAE,EAAE,KAAK,EAAE,eAAe,EAAE,UAAU,EAAE,IAAI,EAAE;QAC9D,UAAU,EAAE;YACV,KAAK,EAAE,uDAAuD,EAAE,cAAc;SAC/E;QACD,gBAAgB,EAAE;YAChB,KAAK,EAAE,+DAA+D;YACtE,KAAK,EAAE,CAAC,CAAS,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SAC5C;QACD,OAAO,EAAE,aAAG,CAAC,QAAQ;KACtB;CACF,CAAC,CAAC;AAEH,SAAS,mBAAmB,CAAC,IAAY;IACvC,IAAI;QACF,IAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,IAAA,aAAK,EAAC,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC;QAC7C,MAAM,WAAW,GAAG,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACxC,GAAG,GAAG,WAAW,CAAC,CAAC,CAAC,oBAAoB,GAAG,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC;QAEpD,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;QAErE,MAAM,OAAO,GAAG,YAAY,CAAC,GAAG,CAAC,SAAS,CAAE,CAAC;QAC7C,MAAM,YAAY,GAAG,YAAY,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC;QAE9D,MAAM,MAAM,GAAsB;YAChC,UAAU,EAAE,uBAAe,CAAC,EAAE;YAC9B,OAAO;YACP,YAAY;SACb,CAAC;QAEF,IAAI,CAAC,WAAW,EAAE;YAChB,IAAI,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;gBAC/B,MAAM,CAAC,YAAY,GAAG,CAAC,WAAW,CAAC,CAAC;aACrC;iBAAM;gBACL,MAAM,CAAC,UAAU,GAAG,iBAAiB,CAAC;aACvC;SACF;QAED,OAAO,MAAM,CAAC;KACf;IAAC,OAAO,GAAG,EAAE;QACZ,OAAO,IAAI,CAAC;KACb;AACH,CAAC;AAED,SAAgB,kBAAkB,CAAC,OAAe;IAChD,MAAM,IAAI,GAAwB,EAAE,CAAC;IACrC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;IACrB,IAAI,KAAK,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC;IACzB,OAAO,KAAK,EAAE;QACZ,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,KAAK,CAAC;QAC9B,IAAI,IAAI,KAAK,YAAY,IAAI,IAAI,KAAK,kBAAkB,EAAE;YACxD,MAAM,GAAG,GAAG,mBAAmB,CAAC,KAAK,CAAC,CAAC;YACvC,IAAI,GAAG,EAAE;gBACP,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aAChB;SACF;QACD,KAAK,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC;KACtB;IACD,OAAO,EAAE,IAAI,EAAE,CAAC;AAClB,CAAC;AAfD,gDAeC;AAEY,QAAA,oBAAoB,GAAG,CAAC,uBAAe,CAAC,EAAE,CAAC,CAAC","sourcesContent":["import moo from 'moo';\nimport { ProgrammingLanguage } from '../../../constants';\nimport { regEx } from '../../../util/regex';\nimport { NugetDatasource } from '../../datasource/nuget';\nimport type { PackageDependency, PackageFile } from '../types';\n\nexport const language = ProgrammingLanguage.NET;\n\nexport const defaultConfig = {\n  fileMatch: ['\\\\.cake$'],\n};\n\nconst lexer = moo.states({\n  main: {\n    lineComment: { match: /\\/\\/.*?$/ }, // TODO #12870\n    multiLineComment: { match: /\\/\\*[^]*?\\*\\//, lineBreaks: true }, // TODO #12870\n    dependency: {\n      match: /^#(?:addin|tool|module|load|l)\\s+(?:nuget|dotnet):.*$/, // TODO #12870\n    },\n    dependencyQuoted: {\n      match: /^#(?:addin|tool|module|load|l)\\s+\"(?:nuget|dotnet):[^\"]+\"\\s*$/, // TODO #12870\n      value: (s: string) => s.trim().slice(1, -1),\n    },\n    unknown: moo.fallback,\n  },\n});\n\nfunction parseDependencyLine(line: string): PackageDependency | null {\n  try {\n    let url = line.replace(regEx(/^[^:]*:/), '');\n    const isEmptyHost = url.startsWith('?');\n    url = isEmptyHost ? `http://localhost/${url}` : url;\n\n    const { origin: registryUrl, protocol, searchParams } = new URL(url);\n\n    const depName = searchParams.get('package')!;\n    const currentValue = searchParams.get('version') ?? undefined;\n\n    const result: PackageDependency = {\n      datasource: NugetDatasource.id,\n      depName,\n      currentValue,\n    };\n\n    if (!isEmptyHost) {\n      if (protocol.startsWith('http')) {\n        result.registryUrls = [registryUrl];\n      } else {\n        result.skipReason = 'unsupported-url';\n      }\n    }\n\n    return result;\n  } catch (err) {\n    return null;\n  }\n}\n\nexport function extractPackageFile(content: string): PackageFile {\n  const deps: PackageDependency[] = [];\n  lexer.reset(content);\n  let token = lexer.next();\n  while (token) {\n    const { type, value } = token;\n    if (type === 'dependency' || type === 'dependencyQuoted') {\n      const dep = parseDependencyLine(value);\n      if (dep) {\n        deps.push(dep);\n      }\n    }\n    token = lexer.next();\n  }\n  return { deps };\n}\n\nexport const supportedDatasources = [NugetDatasource.id];\n"]}