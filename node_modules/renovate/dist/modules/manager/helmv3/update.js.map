{"version":3,"file":"update.js","sourceRoot":"","sources":["../../../../lib/modules/manager/helmv3/update.ts"],"names":[],"mappings":";;;;AAAA,4DAA6C;AAC7C,4CAAyC;AACzC,+CAA4C;AAG5C,SAAgB,kBAAkB,CAChC,OAAe,EACf,YAAoB,EACpB,WAAiC;IAEjC,eAAM,CAAC,KAAK,CACV,EAAE,WAAW,EAAE,YAAY,EAAE,EAC7B,+CAA+C,CAChD,CAAC;IACF,IAAI,eAA8B,CAAC;IACnC,IAAI,aAAa,GAAG,OAAO,CAAC;IAC5B,IAAI;QACF,eAAe,GAAG,gBAAM,CAAC,GAAG,CAAC,YAAY,EAAE,WAA0B,CAAC,CAAC;QACvE,IAAI,CAAC,eAAe,EAAE;YACpB,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC;SACtC;QACD,eAAM,CAAC,KAAK,CAAC,EAAE,eAAe,EAAE,CAAC,CAAC;QAClC,aAAa,GAAG,OAAO,CAAC,OAAO,CAC7B,IAAA,aAAK,EAAC,8BAA8B,EAAE,GAAG,CAAC,EAC1C,aAAa,eAAe,EAAE,CAC/B,CAAC;QACF,IAAI,aAAa,KAAK,OAAO,EAAE;YAC7B,eAAM,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;SAC5C;aAAM;YACL,eAAM,CAAC,KAAK,CAAC,2BAA2B,CAAC,CAAC;SAC3C;KACF;IAAC,OAAO,GAAG,EAAE;QACZ,eAAM,CAAC,IAAI,CACT;YACE,OAAO;YACP,YAAY;YACZ,WAAW;SACZ,EACD,uBAAuB,CACxB,CAAC;KACH;IACD,OAAO,EAAE,aAAa,EAAE,CAAC;AAC3B,CAAC;AArCD,gDAqCC","sourcesContent":["import semver, { ReleaseType } from 'semver';\nimport { logger } from '../../../logger';\nimport { regEx } from '../../../util/regex';\nimport type { BumpPackageVersionResult } from '../types';\n\nexport function bumpPackageVersion(\n  content: string,\n  currentValue: string,\n  bumpVersion: ReleaseType | string\n): BumpPackageVersionResult {\n  logger.debug(\n    { bumpVersion, currentValue },\n    'Checking if we should bump Chart.yaml version'\n  );\n  let newChartVersion: string | null;\n  let bumpedContent = content;\n  try {\n    newChartVersion = semver.inc(currentValue, bumpVersion as ReleaseType);\n    if (!newChartVersion) {\n      throw new Error('semver inc failed');\n    }\n    logger.debug({ newChartVersion });\n    bumpedContent = content.replace(\n      regEx(`^(?<version>version:\\\\s*).*$`, 'm'),\n      `$<version>${newChartVersion}`\n    );\n    if (bumpedContent === content) {\n      logger.debug('Version was already bumped');\n    } else {\n      logger.debug('Bumped Chart.yaml version');\n    }\n  } catch (err) {\n    logger.warn(\n      {\n        content,\n        currentValue,\n        bumpVersion,\n      },\n      'Failed to bumpVersion'\n    );\n  }\n  return { bumpedContent };\n}\n"]}