{"version":3,"file":"collections-metadata.js","sourceRoot":"","sources":["../../../../lib/modules/manager/ansible-galaxy/collections-metadata.ts"],"names":[],"mappings":";;;AAAA,0EAAgF;AAEhF,iCAAsD;AAEtD,SAAgB,8BAA8B,CAC5C,KAAe;IAEf,MAAM,IAAI,GAAwB,EAAE,CAAC;IACrC,uEAAuE;IACvE,IAAI,oBAAoB,GAAG,KAAK,CAAC;IACjC,KAAK,IAAI,UAAU,GAAG,CAAC,EAAE,UAAU,GAAG,KAAK,CAAC,MAAM,EAAE,UAAU,IAAI,CAAC,EAAE;QACnE,MAAM,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC;QAE/B,IAAI,sBAAe,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAC9B,oBAAoB,GAAG,IAAI,CAAC;SAC7B;aAAM,IAAI,oBAAoB,EAAE;YAC/B,wDAAwD;YACxD,MAAM,iBAAiB,GAAG,kBAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjD,IAAI,iBAAiB,EAAE,MAAM,EAAE;gBAC7B,MAAM,GAAG,GAAsB;oBAC7B,OAAO,EAAE,mBAAmB;oBAC5B,UAAU,EAAE,8CAA0B,CAAC,EAAE;oBACzC,OAAO,EAAE,iBAAiB,CAAC,MAAM,CAAC,WAAW;oBAC7C,YAAY,EAAE,iBAAiB,CAAC,MAAM,CAAC,OAAO;iBAC/C,CAAC;gBACF,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aAChB;iBAAM;gBACL,6DAA6D;gBAC7D,MAAM;aACP;SACF;KACF;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AA7BD,wEA6BC","sourcesContent":["import { GalaxyCollectionDatasource } from '../../datasource/galaxy-collection';\nimport type { PackageDependency } from '../types';\nimport { dependencyRegex, galaxyRegEx } from './util';\n\nexport function extractCollectionsMetaDataFile(\n  lines: string[]\n): PackageDependency[] {\n  const deps: PackageDependency[] = [];\n  // in a galaxy.yml the dependency map is inside a `dependencies:` block\n  let foundDependencyBlock = false;\n  for (let lineNumber = 0; lineNumber < lines.length; lineNumber += 1) {\n    const line = lines[lineNumber];\n\n    if (dependencyRegex.exec(line)) {\n      foundDependencyBlock = true;\n    } else if (foundDependencyBlock) {\n      // expects a line like this `  ansible.windows: \"1.4.0\"`\n      const galaxyRegExResult = galaxyRegEx.exec(line);\n      if (galaxyRegExResult?.groups) {\n        const dep: PackageDependency = {\n          depType: 'galaxy-collection',\n          datasource: GalaxyCollectionDatasource.id,\n          depName: galaxyRegExResult.groups.packageName,\n          currentValue: galaxyRegExResult.groups.version,\n        };\n        deps.push(dep);\n      } else {\n        // if we can not match additional lines, the block has ended.\n        break;\n      }\n    }\n  }\n  return deps;\n}\n"]}