{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../lib/modules/datasource/gradle-version/index.ts"],"names":[],"mappings":";;;;AAAA,qEAA8D;AAC9D,+CAA4C;AAC5C,kFAA4D;AAC5D,8CAA2C;AAI3C,MAAa,uBAAwB,SAAQ,uBAAU;IAGrD;QACE,KAAK,CAAC,uBAAuB,CAAC,EAAE,CAAC,CAAC;QAGlB,wBAAmB,GAAG;YACtC,0CAA0C;SAC3C,CAAC;QAEgB,sBAAiB,GAAG,gBAAgB,CAAC,EAAE,CAAC;QAExC,qBAAgB,GAAG,OAAO,CAAC;IAR7C,CAAC;IAoBD,KAAK,CAAC,WAAW,CAAC,EAChB,WAAW,GACO;QAClB,qBAAqB;QACrB,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,IAAI,CAAC;SACb;QAED,IAAI,QAAmB,CAAC;QACxB,IAAI;YACF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,CAAkB,WAAW,CAAC,CAAC;YACvE,QAAQ,GAAG,QAAQ,CAAC,IAAI;iBACrB,MAAM,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC;iBAC1D,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;gBACjB,OAAO,EAAE,OAAO,CAAC,OAAO;gBACxB,gBAAgB,EAAE,uBAAuB,CAAC,eAAe,CACvD,OAAO,CAAC,SAAS,CAClB;gBACD,GAAG,CAAC,OAAO,CAAC,MAAM,IAAI,EAAE,YAAY,EAAE,OAAO,CAAC,MAAM,EAAE,CAAC;aACxD,CAAC,CAAC,CAAC;SACP;QAAC,OAAO,GAAG,EAAE;YACZ,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;SAC/B;QAED,MAAM,GAAG,GAAkB;YACzB,QAAQ;YACR,QAAQ,EAAE,oBAAoB;YAC9B,SAAS,EAAE,kCAAkC;SAC9C,CAAC;QACF,IAAI,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE;YACvB,OAAO,GAAG,CAAC;SACZ;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAEO,MAAM,CAAC,eAAe,CAAC,OAAe;QAC5C,IAAI,CAAC,OAAO,EAAE;YACZ,OAAO,IAAI,CAAC;SACb;QACD,IAAI,uBAAuB,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YACxD,OAAO,OAAO,CAAC,OAAO,CACpB,uBAAuB,CAAC,cAAc,EACtC,qBAAqB,CACtB,CAAC;SACH;QACD,OAAO,IAAI,CAAC;IACd,CAAC;;AAtEe,0BAAE,GAAG,gBAAgB,CAAC;AAcd,sCAAc,GAAG,IAAA,aAAK,EAC5C,2EAA2E,CAC5E,CAAC;AAQF;IANC,IAAA,iBAAK,EAAC;QACL,SAAS,EAAE,cAAc,uBAAuB,CAAC,EAAE,EAAE;QACrD,sBAAsB;QACtB,4EAA4E;QAC5E,GAAG,EAAE,CAAC,EAAE,WAAW,EAAqB,EAAE,EAAE,CAAC,GAAG,WAAW,EAAE;KAC9D,CAAC;0DAkCD;AA1DH,0DAwEC","sourcesContent":["import { cache } from '../../../util/cache/package/decorator';\nimport { regEx } from '../../../util/regex';\nimport * as gradleVersioning from '../../versioning/gradle';\nimport { Datasource } from '../datasource';\nimport type { GetReleasesConfig, Release, ReleaseResult } from '../types';\nimport type { GradleRelease } from './types';\n\nexport class GradleVersionDatasource extends Datasource {\n  static readonly id = 'gradle-version';\n\n  constructor() {\n    super(GradleVersionDatasource.id);\n  }\n\n  override readonly defaultRegistryUrls = [\n    'https://services.gradle.org/versions/all',\n  ];\n\n  override readonly defaultVersioning = gradleVersioning.id;\n\n  override readonly registryStrategy = 'merge';\n\n  private static readonly buildTimeRegex = regEx(\n    '^(\\\\d\\\\d\\\\d\\\\d)(\\\\d\\\\d)(\\\\d\\\\d)(\\\\d\\\\d)(\\\\d\\\\d)(\\\\d\\\\d)(\\\\+\\\\d\\\\d\\\\d\\\\d)$'\n  );\n\n  @cache({\n    namespace: `datasource-${GradleVersionDatasource.id}`,\n    // TODO: types (#7154)\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    key: ({ registryUrl }: GetReleasesConfig) => `${registryUrl}`,\n  })\n  async getReleases({\n    registryUrl,\n  }: GetReleasesConfig): Promise<ReleaseResult | null> {\n    // istanbul ignore if\n    if (!registryUrl) {\n      return null;\n    }\n\n    let releases: Release[];\n    try {\n      const response = await this.http.getJson<GradleRelease[]>(registryUrl);\n      releases = response.body\n        .filter((release) => !release.snapshot && !release.nightly)\n        .map((release) => ({\n          version: release.version,\n          releaseTimestamp: GradleVersionDatasource.formatBuildTime(\n            release.buildTime\n          ),\n          ...(release.broken && { isDeprecated: release.broken }),\n        }));\n    } catch (err) {\n      this.handleGenericErrors(err);\n    }\n\n    const res: ReleaseResult = {\n      releases,\n      homepage: 'https://gradle.org',\n      sourceUrl: 'https://github.com/gradle/gradle',\n    };\n    if (res.releases.length) {\n      return res;\n    }\n    return null;\n  }\n\n  private static formatBuildTime(timeStr: string): string | null {\n    if (!timeStr) {\n      return null;\n    }\n    if (GradleVersionDatasource.buildTimeRegex.test(timeStr)) {\n      return timeStr.replace(\n        GradleVersionDatasource.buildTimeRegex,\n        '$1-$2-$3T$4:$5:$6$7'\n      );\n    }\n    return null;\n  }\n}\n"]}