{"version":3,"file":"common.js","sourceRoot":"","sources":["../../../../lib/modules/datasource/nuget/common.ts"],"names":[],"mappings":";;;AAAA,4CAAyC;AACzC,+CAA4C;AAC5C,2CAA6C;AAG7C,MAAM,WAAW,GAAG,IAAA,aAAK,EAAC,QAAQ,CAAC,CAAC;AAEpC,SAAgB,eAAe,CAAC,OAAe;IAC7C,OAAO,OAAO,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;AAC1C,CAAC;AAFD,0CAEC;AAED,MAAM,eAAe,GAAG,IAAA,aAAK,EAAC,KAAK,CAAC,CAAC;AAErC,SAAgB,UAAU,CAAC,GAAW;IACpC,IAAI,SAAS,GAAG,GAAG,CAAC;IAEpB,0FAA0F;IAC1F,gDAAgD;IAChD,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;IAEtD,OAAO,SAAS,CAAC;AACnB,CAAC;AARD,gCAQC;AAED,MAAM,qBAAqB,GAAG,IAAA,aAAK,EAAC,mCAAmC,CAAC,CAAC;AAEzE,SAAgB,gBAAgB,CAAC,WAAmB;IAClD,MAAM,SAAS,GAAG,IAAA,cAAQ,EAAC,WAAW,CAAC,CAAC;IACxC,IAAI,CAAC,SAAS,EAAE;QACd,eAAM,CAAC,KAAK,CACV,EAAE,GAAG,EAAE,WAAW,EAAE,EACpB,uCAAuC,WAAW,EAAE,CACrD,CAAC;QACF,OAAO,EAAE,OAAO,EAAE,WAAW,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC;KACxD;IACD,IAAI,eAAe,GAAG,CAAC,CAAC;IACxB,MAAM,oBAAoB,GAAG,qBAAqB,CAAC,IAAI,CACrD,SAAS,CAAC,IAAI,CACf,EAAE,MAAM,CAAC;IACV,IAAI,oBAAoB,EAAE;QACxB,MAAM,EAAE,QAAQ,EAAE,GAAG,oBAAoB,CAAC;QAC1C,SAAS,CAAC,IAAI,GAAG,EAAE,CAAC;QACpB,eAAe,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;KACjD;SAAM,IAAI,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;QAC/C,eAAe,GAAG,CAAC,CAAC;KACrB;IAED,MAAM,OAAO,GAAG,SAAS,CAAC,IAAI,CAAC;IAC/B,OAAO,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC;AACtC,CAAC;AAvBD,4CAuBC","sourcesContent":["import { logger } from '../../../logger';\nimport { regEx } from '../../../util/regex';\nimport { parseUrl } from '../../../util/url';\nimport type { ParsedRegistryUrl } from './types';\n\nconst buildMetaRe = regEx(/\\+.+$/g);\n\nexport function removeBuildMeta(version: string): string {\n  return version.replace(buildMetaRe, '');\n}\n\nconst urlWhitespaceRe = regEx(/\\s/g);\n\nexport function massageUrl(url: string): string {\n  let resultUrl = url;\n\n  // During `dotnet pack` certain URLs are being URL decoded which may introduce whitespaces\n  // and causes Markdown link generation problems.\n  resultUrl = resultUrl.replace(urlWhitespaceRe, '%20');\n\n  return resultUrl;\n}\n\nconst protocolVersionRegExp = regEx(/#protocolVersion=(?<protocol>2|3)/);\n\nexport function parseRegistryUrl(registryUrl: string): ParsedRegistryUrl {\n  const parsedUrl = parseUrl(registryUrl);\n  if (!parsedUrl) {\n    logger.debug(\n      { urL: registryUrl },\n      `nuget registry failure: can't parse ${registryUrl}`\n    );\n    return { feedUrl: registryUrl, protocolVersion: null };\n  }\n  let protocolVersion = 2;\n  const protocolVersionMatch = protocolVersionRegExp.exec(\n    parsedUrl.hash\n  )?.groups;\n  if (protocolVersionMatch) {\n    const { protocol } = protocolVersionMatch;\n    parsedUrl.hash = '';\n    protocolVersion = Number.parseInt(protocol, 10);\n  } else if (parsedUrl.pathname.endsWith('.json')) {\n    protocolVersion = 3;\n  }\n\n  const feedUrl = parsedUrl.href;\n  return { feedUrl, protocolVersion };\n}\n"]}