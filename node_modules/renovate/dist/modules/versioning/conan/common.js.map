{"version":3,"file":"common.js","sourceRoot":"","sources":["../../../../lib/modules/versioning/conan/common.ts"],"names":[],"mappings":"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","sourcesContent":["import * as semver from 'semver';\nimport { regEx } from '../../../util/regex';\n\nexport function makeVersion(\n  version: string,\n  options: semver.Options\n): string | boolean | null {\n  const splitVersion = version.split('.');\n  const prerelease = semver.prerelease(version, options);\n\n  if (prerelease && !options.includePrerelease) {\n    if (!Number.isNaN(parseInt(prerelease.toString()[0], 10))) {\n      const stringVersion = `${splitVersion[0]}.${splitVersion[1]}.${splitVersion[2]}`;\n      return semver.valid(stringVersion, options);\n    }\n    return false;\n  }\n\n  if (\n    options.loose &&\n    !semver.valid(version, options) &&\n    splitVersion.length !== 3\n  ) {\n    return semver.valid(semver.coerce(version, options), options);\n  }\n  return semver.valid(version, options);\n}\n\nexport function cleanVersion(version: string): string {\n  if (version) {\n    return version\n      .replace(regEx(/,|\\[|\\]|\"|include_prerelease=|loose=|True|False/g), '')\n      .trim();\n  }\n  return version;\n}\n\nexport function getOptions(input: string): {\n  loose: boolean;\n  includePrerelease: boolean;\n} {\n  let includePrerelease = false;\n  let loose = true;\n  if (input) {\n    includePrerelease =\n      input.includes('include_prerelease=True') &&\n      !input.includes('include_prerelease=False');\n    loose = input.includes('loose=True') || !input.includes('loose=False');\n  }\n  return { loose, includePrerelease };\n}\n\nexport function containsOperators(input: string): boolean {\n  return regEx('[<=>^~]').test(input);\n}\n\nexport function matchesWithOptions(\n  version: string,\n  cleanRange: string,\n  options: semver.Options\n): boolean {\n  let cleanedVersion = version;\n  if (\n    cleanedVersion &&\n    semver.prerelease(cleanedVersion) &&\n    options.includePrerelease\n  ) {\n    const coercedVersion = semver.coerce(cleanedVersion)?.raw;\n    cleanedVersion = coercedVersion ? coercedVersion : '';\n  }\n  return semver.satisfies(cleanedVersion, cleanRange, options);\n}\n\nexport function findSatisfyingVersion(\n  versions: string[],\n  range: string,\n  compareRt: number\n): string | null {\n  const options = getOptions(range);\n  let cur: any = null;\n  let curSV: any = null;\n  let index = 0;\n  let curIndex = -1;\n\n  for (const v of versions) {\n    const versionFromList = makeVersion(v, options);\n    if (typeof versionFromList === 'string') {\n      const cleanedVersion = cleanVersion(versionFromList);\n      const options = getOptions(range);\n      const cleanRange = cleanVersion(range);\n      if (matchesWithOptions(cleanedVersion, cleanRange, options)) {\n        if (\n          !cur ||\n          semver.compare(curSV, versionFromList, options) === compareRt\n        ) {\n          cur = versionFromList;\n          curIndex = index;\n          curSV = new semver.SemVer(cur, options);\n        }\n      }\n    }\n    index += 1;\n  }\n  if (curIndex >= 0) {\n    return versions[curIndex];\n  }\n  return null;\n}\n"]}