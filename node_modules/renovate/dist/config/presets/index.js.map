{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../lib/config/presets/index.ts"],"names":[],"mappings":"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","sourcesContent":["import is from '@sindresorhus/is';\nimport {\n  CONFIG_VALIDATION,\n  PLATFORM_RATE_LIMIT_EXCEEDED,\n} from '../../constants/error-messages';\nimport { logger } from '../../logger';\nimport { ExternalHostError } from '../../types/errors/external-host-error';\nimport * as memCache from '../../util/cache/memory';\nimport { clone } from '../../util/clone';\nimport { regEx } from '../../util/regex';\nimport * as massage from '../massage';\nimport * as migration from '../migration';\nimport type { AllConfig, RenovateConfig } from '../types';\nimport { mergeChildConfig } from '../utils';\nimport { removedPresets } from './common';\nimport * as gitea from './gitea';\nimport * as github from './github';\nimport * as gitlab from './gitlab';\nimport * as internal from './internal';\nimport * as local from './local';\nimport * as npm from './npm';\nimport type { ParsedPreset, Preset, PresetApi } from './types';\nimport {\n  PRESET_DEP_NOT_FOUND,\n  PRESET_INVALID,\n  PRESET_INVALID_JSON,\n  PRESET_NOT_FOUND,\n  PRESET_PROHIBITED_SUBPRESET,\n  PRESET_RENOVATE_CONFIG_NOT_FOUND,\n} from './util';\n\nconst presetSources: Record<string, PresetApi> = {\n  github,\n  npm,\n  gitlab,\n  gitea,\n  local,\n  internal,\n};\n\nconst nonScopedPresetWithSubdirRegex = regEx(\n  /^(?<repo>~?[\\w\\-. /]+?)\\/\\/(?:(?<presetPath>[\\w\\-./]+)\\/)?(?<presetName>[\\w\\-.]+)(?:#(?<tag>[\\w\\-./]+?))?$/\n);\nconst gitPresetRegex = regEx(\n  /^(?<repo>~?[\\w\\-. /]+)(?::(?<presetName>[\\w\\-.+/]+))?(?:#(?<tag>[\\w\\-./]+?))?$/\n);\n\nexport function replaceArgs(\n  obj: string,\n  argMapping: Record<string, any>\n): string;\nexport function replaceArgs(\n  obj: string[],\n  argMapping: Record<string, any>\n): string[];\nexport function replaceArgs(\n  obj: Record<string, any>,\n  argMapping: Record<string, any>\n): Record<string, any>;\nexport function replaceArgs(\n  obj: Record<string, any>[],\n  argMapping: Record<string, any>\n): Record<string, any>[];\n\n/**\n * TODO: fix me #7154\n * @param obj\n * @param argMapping\n */\nexport function replaceArgs(obj: any, argMapping: Record<string, any>): any;\nexport function replaceArgs(\n  obj: string | string[] | Record<string, any> | Record<string, any>[],\n  argMapping: Record<string, any>\n): any {\n  if (is.string(obj)) {\n    let returnStr = obj;\n    for (const [arg, argVal] of Object.entries(argMapping)) {\n      const re = regEx(`{{${arg}}}`, 'g', false);\n      returnStr = returnStr.replace(re, argVal);\n    }\n    return returnStr;\n  }\n  if (is.array(obj)) {\n    const returnArray = [];\n    for (const item of obj) {\n      returnArray.push(replaceArgs(item, argMapping));\n    }\n    return returnArray;\n  }\n  if (is.object(obj)) {\n    const returnObj: Record<string, any> = {};\n    for (const [key, val] of Object.entries(obj)) {\n      returnObj[key] = replaceArgs(val, argMapping);\n    }\n    return returnObj;\n  }\n  return obj;\n}\n\nexport function parsePreset(input: string): ParsedPreset {\n  let str = input;\n  let presetSource: string | undefined;\n  let presetPath: string | undefined;\n  let repo: string;\n  let presetName: string;\n  let tag: string | undefined;\n  let params: string[] | undefined;\n  if (str.startsWith('github>')) {\n    presetSource = 'github';\n    str = str.substring('github>'.length);\n  } else if (str.startsWith('gitlab>')) {\n    presetSource = 'gitlab';\n    str = str.substring('gitlab>'.length);\n  } else if (str.startsWith('gitea>')) {\n    presetSource = 'gitea';\n    str = str.substring('gitea>'.length);\n  } else if (str.startsWith('local>')) {\n    presetSource = 'local';\n    str = str.substring('local>'.length);\n  } else if (\n    !str.startsWith('@') &&\n    !str.startsWith(':') &&\n    str.includes('/')\n  ) {\n    presetSource = 'local';\n  }\n  str = str.replace(regEx(/^npm>/), '');\n  presetSource = presetSource ?? 'npm';\n  if (str.includes('(')) {\n    params = str\n      .slice(str.indexOf('(') + 1, -1)\n      .split(',')\n      .map((elem) => elem.trim());\n    str = str.slice(0, str.indexOf('('));\n  }\n  const presetsPackages = [\n    'compatibility',\n    'config',\n    'default',\n    'docker',\n    'group',\n    'helpers',\n    'monorepo',\n    'npm',\n    'packages',\n    'preview',\n    'regexManagers',\n    'replacements',\n    'schedule',\n    'workarounds',\n  ];\n  if (\n    presetsPackages.some((presetPackage) => str.startsWith(`${presetPackage}:`))\n  ) {\n    presetSource = 'internal';\n    [repo, presetName] = str.split(':');\n  } else if (str.startsWith(':')) {\n    // default namespace\n    presetSource = 'internal';\n    repo = 'default';\n    presetName = str.slice(1);\n  } else if (str.startsWith('@')) {\n    // scoped namespace\n    [, repo] = regEx(/(@.*?)(:|$)/).exec(str)!;\n    str = str.slice(repo.length);\n    if (!repo.includes('/')) {\n      repo += '/renovate-config';\n    }\n    if (str === '') {\n      presetName = 'default';\n    } else {\n      presetName = str.slice(1);\n    }\n  } else if (str.includes('//')) {\n    // non-scoped namespace with a subdirectory preset\n\n    // Validation\n    if (str.includes(':')) {\n      throw new Error(PRESET_PROHIBITED_SUBPRESET);\n    }\n    if (!nonScopedPresetWithSubdirRegex.test(str)) {\n      throw new Error(PRESET_INVALID);\n    }\n    ({ repo, presetPath, presetName, tag } =\n      nonScopedPresetWithSubdirRegex.exec(str)?.groups ?? {});\n  } else {\n    ({ repo, presetName, tag } = gitPresetRegex.exec(str)?.groups ?? {});\n\n    if (presetSource === 'npm' && !repo.startsWith('renovate-config-')) {\n      repo = `renovate-config-${repo}`;\n    }\n    if (!is.nonEmptyString(presetName)) {\n      presetName = 'default';\n    }\n  }\n\n  return {\n    presetSource,\n    presetPath,\n    repo,\n    presetName,\n    tag,\n    params,\n  };\n}\n\nexport async function getPreset(\n  preset: string,\n  baseConfig?: RenovateConfig\n): Promise<RenovateConfig> {\n  logger.trace(`getPreset(${preset})`);\n  // Check if the preset has been removed or replaced\n  const newPreset = removedPresets[preset];\n  if (newPreset) {\n    return getPreset(newPreset, baseConfig);\n  }\n  if (newPreset === null) {\n    return {};\n  }\n  const { presetSource, repo, presetPath, presetName, tag, params } =\n    parsePreset(preset);\n  const cacheKey = `preset:${preset}`;\n  let presetConfig = memCache.get<Preset | null | undefined>(cacheKey);\n  if (is.nullOrUndefined(presetConfig)) {\n    presetConfig = await presetSources[presetSource].getPreset({\n      repo,\n      presetPath,\n      presetName,\n      tag,\n    });\n    memCache.set(cacheKey, presetConfig);\n  }\n  if (!presetConfig) {\n    throw new Error(PRESET_DEP_NOT_FOUND);\n  }\n  logger.trace({ presetConfig }, `Found preset ${preset}`);\n  if (params) {\n    const argMapping: Record<string, string> = {};\n    for (const [index, value] of params.entries()) {\n      argMapping[`arg${index}`] = value;\n    }\n    presetConfig = replaceArgs(presetConfig, argMapping);\n  }\n  logger.trace({ presetConfig }, `Applied params to preset ${preset}`);\n  const presetKeys = Object.keys(presetConfig);\n  // istanbul ignore if\n  if (\n    presetKeys.length === 2 &&\n    presetKeys.includes('description') &&\n    presetKeys.includes('extends')\n  ) {\n    // preset is just a collection of other presets\n    delete presetConfig.description;\n  }\n  const packageListKeys = [\n    'description',\n    'matchPackageNames',\n    'excludePackageNames',\n    'matchPackagePatterns',\n    'excludePackagePatterns',\n    'matchPackagePrefixes',\n    'excludePackagePrefixes',\n  ];\n  if (presetKeys.every((key) => packageListKeys.includes(key))) {\n    delete presetConfig.description;\n  }\n  const { migratedConfig } = migration.migrateConfig(presetConfig);\n  return massage.massageConfig(migratedConfig);\n}\n\nexport async function resolveConfigPresets(\n  inputConfig: AllConfig,\n  baseConfig?: RenovateConfig,\n  _ignorePresets?: string[],\n  existingPresets: string[] = []\n): Promise<AllConfig> {\n  let ignorePresets = clone(_ignorePresets);\n  if (!ignorePresets || ignorePresets.length === 0) {\n    ignorePresets = inputConfig.ignorePresets ?? [];\n  }\n  logger.trace(\n    { config: inputConfig, existingPresets },\n    'resolveConfigPresets'\n  );\n  let config: AllConfig = {};\n  // First, merge all the preset configs from left to right\n  if (inputConfig.extends?.length) {\n    for (const preset of inputConfig.extends) {\n      if (shouldResolvePreset(preset, existingPresets, ignorePresets)) {\n        logger.trace(`Resolving preset \"${preset}\"`);\n        const fetchedPreset = await fetchPreset(\n          preset,\n          baseConfig,\n          inputConfig,\n          existingPresets\n        );\n        const presetConfig = await resolveConfigPresets(\n          fetchedPreset,\n          baseConfig ?? inputConfig,\n          ignorePresets,\n          existingPresets.concat([preset])\n        );\n        // istanbul ignore if\n        if (inputConfig?.ignoreDeps?.length === 0) {\n          delete presetConfig.description;\n        }\n        config = mergeChildConfig(config, presetConfig);\n      }\n    }\n  }\n  logger.trace({ config }, `Post-preset resolve config`);\n  // Now assign \"regular\" config on top\n  config = mergeChildConfig(config, inputConfig);\n  delete config.extends;\n  delete config.ignorePresets;\n  logger.trace({ config }, `Post-merge resolve config`);\n  for (const [key, val] of Object.entries(config)) {\n    const ignoredKeys = ['content', 'onboardingConfig'];\n    if (is.array(val)) {\n      // Resolve nested objects inside arrays\n      config[key] = [];\n      for (const element of val) {\n        if (is.object(element)) {\n          (config[key] as RenovateConfig[]).push(\n            await resolveConfigPresets(\n              element as RenovateConfig,\n              baseConfig,\n              ignorePresets,\n              existingPresets\n            )\n          );\n        } else {\n          (config[key] as unknown[]).push(element);\n        }\n      }\n    } else if (is.object(val) && !ignoredKeys.includes(key)) {\n      // Resolve nested objects\n      logger.trace(`Resolving object \"${key}\"`);\n      config[key] = await resolveConfigPresets(\n        val as RenovateConfig,\n        baseConfig,\n        ignorePresets,\n        existingPresets\n      );\n    }\n  }\n  logger.trace({ config: inputConfig }, 'Input config');\n  logger.trace({ config }, 'Resolved config');\n  return config;\n}\n\nasync function fetchPreset(\n  preset: string,\n  baseConfig: RenovateConfig | undefined,\n  inputConfig: AllConfig,\n  existingPresets: string[]\n): Promise<AllConfig> {\n  try {\n    return await getPreset(preset, baseConfig ?? inputConfig);\n  } catch (err) {\n    logger.debug({ preset, err }, 'Preset fetch error');\n    // istanbul ignore if\n    if (err instanceof ExternalHostError) {\n      throw err;\n    }\n    // istanbul ignore if\n    if (err.message === PLATFORM_RATE_LIMIT_EXCEEDED) {\n      throw err;\n    }\n    const error = new Error(CONFIG_VALIDATION);\n    if (err.message === PRESET_DEP_NOT_FOUND) {\n      error.validationError = `Cannot find preset's package (${preset})`;\n    } else if (err.message === PRESET_RENOVATE_CONFIG_NOT_FOUND) {\n      error.validationError = `Preset package is missing a renovate-config entry (${preset})`;\n    } else if (err.message === PRESET_NOT_FOUND) {\n      error.validationError = `Preset name not found within published preset config (${preset})`;\n    } else if (err.message === PRESET_INVALID) {\n      error.validationError = `Preset is invalid (${preset})`;\n    } else if (err.message === PRESET_PROHIBITED_SUBPRESET) {\n      error.validationError = `Sub-presets cannot be combined with a custom path (${preset})`;\n    } else if (err.message === PRESET_INVALID_JSON) {\n      error.validationError = `Preset is invalid JSON (${preset})`;\n    } else {\n      error.validationError = `Preset caused unexpected error (${preset})`;\n    }\n    // istanbul ignore if\n    if (existingPresets.length) {\n      error.validationError +=\n        '. Note: this is a *nested* preset so please contact the preset author if you are unable to fix it yourself.';\n    }\n    logger.info(\n      { validationError: error.validationError },\n      'Throwing preset error'\n    );\n    throw error;\n  }\n}\n\nfunction shouldResolvePreset(\n  preset: string,\n  existingPresets: string[],\n  ignorePresets: string[]\n): boolean {\n  // istanbul ignore if\n  if (existingPresets.includes(preset)) {\n    logger.debug(\n      `Already seen preset ${preset} in [${existingPresets.join(', ')}]`\n    );\n    return false;\n  }\n  if (ignorePresets.includes(preset)) {\n    // istanbul ignore next\n    logger.debug(\n      `Ignoring preset ${preset} in [${existingPresets.join(', ')}]`\n    );\n    return false;\n  }\n  return true;\n}\n"]}