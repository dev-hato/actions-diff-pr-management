{"version":3,"file":"migrate-validate.js","sourceRoot":"","sources":["../../lib/config/migrate-validate.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAClC,sCAAmC;AACnC,iEAA2C;AAC3C,qEAA+C;AAE/C,uEAAiD;AAE1C,KAAK,UAAU,kBAAkB,CACtC,MAAsB,EACtB,KAAqB;IAErB,eAAM,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;IACrC,IAAI;QACF,MAAM,EAAE,UAAU,EAAE,cAAc,EAAE,GAAG,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC5E,IAAI,UAAU,EAAE;YACd,eAAM,CAAC,KAAK,CACV,EAAE,SAAS,EAAE,KAAK,EAAE,SAAS,EAAE,cAAc,EAAE,EAC/C,4BAA4B,CAC7B,CAAC;SACH;aAAM;YACL,eAAM,CAAC,KAAK,CAAC,+BAA+B,CAAC,CAAC;SAC/C;QACD,MAAM,cAAc,GAAG,aAAa,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;QACnE,eAAM,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,cAAc,EAAE,EAAE,iBAAiB,CAAC,CAAC;QAC5D,MAAM,EACJ,QAAQ,EACR,MAAM,GACP,GAGG,MAAM,gBAAgB,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;QAC1D,qBAAqB;QACrB,IAAI,YAAE,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAE;YAC9B,eAAM,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,EAAE,gCAAgC,CAAC,CAAC;SAC7D;QACD,IAAI,YAAE,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE;YAC5B,eAAM,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,EAAE,8BAA8B,CAAC,CAAC;SACzD;QACD,cAAc,CAAC,MAAM,GAAG,CAAC,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAC7D,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;YAC3B,cAAc,CAAC,QAAQ,GAAG,CAAC,MAAM,CAAC,QAAQ,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;SACpE;QACD,OAAO,cAAc,CAAC;KACvB;IAAC,OAAO,GAAG,EAAE,0BAA0B,CAAC;QACvC,eAAM,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,0BAA0B,CAAC,CAAC;QAC5D,MAAM,GAAG,CAAC;KACX;AACH,CAAC;AAxCD,gDAwCC","sourcesContent":["import is from '@sindresorhus/is';\nimport { logger } from '../logger';\nimport * as configMassage from './massage';\nimport * as configMigration from './migration';\nimport type { RenovateConfig, ValidationMessage } from './types';\nimport * as configValidation from './validation';\n\nexport async function migrateAndValidate(\n  config: RenovateConfig,\n  input: RenovateConfig\n): Promise<RenovateConfig> {\n  logger.debug('migrateAndValidate()');\n  try {\n    const { isMigrated, migratedConfig } = configMigration.migrateConfig(input);\n    if (isMigrated) {\n      logger.debug(\n        { oldConfig: input, newConfig: migratedConfig },\n        'Config migration necessary'\n      );\n    } else {\n      logger.debug('No config migration necessary');\n    }\n    const massagedConfig = configMassage.massageConfig(migratedConfig);\n    logger.debug({ config: massagedConfig }, 'massaged config');\n    const {\n      warnings,\n      errors,\n    }: {\n      warnings: ValidationMessage[];\n      errors: ValidationMessage[];\n    } = await configValidation.validateConfig(massagedConfig);\n    // istanbul ignore if\n    if (is.nonEmptyArray(warnings)) {\n      logger.warn({ warnings }, 'Found renovate config warnings');\n    }\n    if (is.nonEmptyArray(errors)) {\n      logger.info({ errors }, 'Found renovate config errors');\n    }\n    massagedConfig.errors = (config.errors ?? []).concat(errors);\n    if (!config.repoIsOnboarded) {\n      massagedConfig.warnings = (config.warnings ?? []).concat(warnings);\n    }\n    return massagedConfig;\n  } catch (err) /* istanbul ignore next */ {\n    logger.debug({ config: input }, 'migrateAndValidate error');\n    throw err;\n  }\n}\n"]}