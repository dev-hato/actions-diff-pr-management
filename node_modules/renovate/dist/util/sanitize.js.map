{"version":3,"file":"sanitize.js","sourceRoot":"","sources":["../../lib/util/sanitize.ts"],"names":[],"mappings":";;;;AAAA,kEAAkC;AAClC,qCAAoC;AAEpC,MAAM,aAAa,GAAG,IAAI,GAAG,EAAU,CAAC;AACxC,MAAM,WAAW,GAAG,IAAI,GAAG,EAAU,CAAC;AAEzB,QAAA,cAAc,GAAG;IAC5B,eAAe;IACf,OAAO;IACP,cAAc;IACd,UAAU;IACV,OAAO;IACP,YAAY;IACZ,eAAe;IACf,eAAe;IACf,WAAW;IACX,UAAU;CACX,CAAC;AAOF,SAAgB,QAAQ,CACtB,KAAgC;IAEhC,IAAI,CAAC,KAAK,EAAE;QACV,OAAO,KAAK,CAAC;KACd;IACD,IAAI,MAAM,GAAW,KAAK,CAAC;IAC3B,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;QAC/C,OAAO,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,EAAE;YACzB,OAAO,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;gBAC9B,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;aACjD;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IACH,OAAO,MAAM,CAAC;AAChB,CAAC;AAfD,4BAeC;AAED,MAAM,uBAAuB,GAAG,iBAAiB,CAAC;AAElD,SAAgB,sBAAsB,CAAC,MAAc,EAAE,IAAI,GAAG,MAAM;IAClE,IAAI,CAAC,YAAE,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;QAC9B,OAAO;KACR;IACD,MAAM,OAAO,GAAG,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,aAAa,CAAC;IAC9D,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACpB,OAAO,CAAC,GAAG,CAAC,IAAA,iBAAQ,EAAC,MAAM,CAAC,CAAC,CAAC;IAC9B,IAAI,MAAM,CAAC,UAAU,CAAC,uBAAuB,CAAC,EAAE;QAC9C,MAAM,aAAa,GAAG,MAAM,CAAC,OAAO,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAAC;QAClE,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAC3B,OAAO,CAAC,GAAG,CAAC,IAAA,iBAAQ,EAAC,aAAa,CAAC,CAAC,CAAC;KACtC;AACH,CAAC;AAZD,wDAYC;AAED,SAAgB,yBAAyB,CAAC,IAAI,GAAG,MAAM;IACrD,MAAM,OAAO,GAAG,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,aAAa,CAAC;IAC9D,OAAO,CAAC,KAAK,EAAE,CAAC;AAClB,CAAC;AAHD,8DAGC","sourcesContent":["import is from '@sindresorhus/is';\nimport { toBase64 } from './string';\n\nconst globalSecrets = new Set<string>();\nconst repoSecrets = new Set<string>();\n\nexport const redactedFields = [\n  'authorization',\n  'token',\n  'githubAppKey',\n  'npmToken',\n  'npmrc',\n  'privateKey',\n  'privateKeyOld',\n  'gitPrivateKey',\n  'forkToken',\n  'password',\n];\n\n// TODO: returns null or undefined only when input is null or undefined.\nexport function sanitize(input: string): string;\nexport function sanitize(\n  input: string | null | undefined\n): string | null | undefined;\nexport function sanitize(\n  input: string | null | undefined\n): string | null | undefined {\n  if (!input) {\n    return input;\n  }\n  let output: string = input;\n  [globalSecrets, repoSecrets].forEach((secrets) => {\n    secrets.forEach((secret) => {\n      while (output.includes(secret)) {\n        output = output.replace(secret, '**redacted**');\n      }\n    });\n  });\n  return output;\n}\n\nconst GITHUB_APP_TOKEN_PREFIX = 'x-access-token:';\n\nexport function addSecretForSanitizing(secret: string, type = 'repo'): void {\n  if (!is.nonEmptyString(secret)) {\n    return;\n  }\n  const secrets = type === 'repo' ? repoSecrets : globalSecrets;\n  secrets.add(secret);\n  secrets.add(toBase64(secret));\n  if (secret.startsWith(GITHUB_APP_TOKEN_PREFIX)) {\n    const trimmedSecret = secret.replace(GITHUB_APP_TOKEN_PREFIX, '');\n    secrets.add(trimmedSecret);\n    secrets.add(toBase64(trimmedSecret));\n  }\n}\n\nexport function clearSanitizedSecretsList(type = 'repo'): void {\n  const secrets = type === 'repo' ? repoSecrets : globalSecrets;\n  secrets.clear();\n}\n"]}